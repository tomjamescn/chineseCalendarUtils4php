<?php
/**
 * Created by PhpStorm.
 * User: tomjamescn
 * Date: 2017/5/16
 * Time: 下午1:29
 */


function curl($url, $referer = '') {
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_HEADER, 0);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30);   //连接超时时间设置为10秒
    curl_setopt($ch, CURLOPT_TIMEOUT, 60);          //处理超时时间
    curl_setopt($ch, CURLOPT_REFERER, $referer);


    $html = curl_exec($ch);
    $curlErrno = curl_errno($ch);
    $curlError = curl_error($ch);
    curl_close($ch);
    if($html === false || $curlErrno > 0) {
        echo "curl错误:{$curlError}\n";
        return false;
    }
    return $html;
}



$holidayJsonString = '{"2009":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"],"2010":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"],"2011":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"],"2012":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"],"2013":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"],"2014":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"],"2015":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"],"2016":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"],"2017":["0102","0103","0125","0126","0127","0128","0129","0130","0131","0404","0405","0406","0501","0502","0503","0528","0529","0530","1001","1002","1003","1004","1005","1006","1007","1008","0101"]}';

$startDate = '2009-01-01';
$endDate = '2017-12-31';

$result = [
    'specialTradingDateList' => [],
    'specialNotTradingDateList' => [],

];

$holidayJson = json_decode($holidayJsonString, true);
foreach ($holidayJson as $year => $data) {
    foreach ($data as $monthDay) {
        $result['specialNotTradingDateList'][] = date('Y-m-d', strtotime("{$year}{$monthDay}"));
    }
}

$curDate = $startDate;
while($curDate <= $endDate) {

    $weekDay = date('N', strtotime($curDate));
    if ($weekDay == 6 || $weekDay == 7) {
        $url = 'http://tool.bitefu.net/jiari/?d='.date('Ymd', strtotime($curDate));
        echo "$url\n";
        $ret = curl($url);
        if ($ret == 0 ) {
            //工作日
            $result['specialTradingDateList'][] = $curDate;
        }
    }


    $curDate = date('Y-m-d', strtotime('+1 days', strtotime($curDate)));
}


echo json_encode($result);
